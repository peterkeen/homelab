<%-
endpoints = []

hosts.each do |host|
  endpoints << {
    "name" => host.hostname,
    "group" => "host-backups",
    "token" => "$GATUS_API_TOKEN_#{host.normalized_hostname}",
    "heartbeat" => {
      "interval" => "24h"
    }
  }

  endpoints << {
    "name" => host.hostname,
    "group" => "certificate-sync",
    "token" => "$GATUS_API_TOKEN_#{host.normalized_hostname}",
    "heartbeat" => {
      "interval" => "24h"
    }
  }

  has_coredns = host.stacks.detect { |stack| stack.name == "coredns" }
  if has_coredns
    endpoints << {
      "name" => host.hostname,
      "group" => "unbound-blocklist-sync",
      "token" => "$GATUS_API_TOKEN_#{host.normalized_hostname}",
      "heartbeat" => {
        "interval" => "24h"
      }
    }
  end
end
-%>
<%= {"external-endpoints" => endpoints}.to_yaml %>
